path_nodes = [[398.105, 1169.66], [396.2825, 1166.265], [394.96625, 1162.50625]]
# Create polygon
points1 = [
    [
        398.105,
        397.22392545,
        395.33869548,
        394.96625,
        394.96625,
        397.22630452,
        398.98607455,
        398.105,
    ],
    [
        1169.66,
        1170.13297743,
        1166.59550421,
        1162.50625,
        1162.50625,
        1165.93449579,
        1169.18702257,
        1169.66,
    ],
]
points2 = [
    [
        398.105,
        397.22392545,
        395.33869548,
        394.96625,
        394.96625,
        397.22630452,
        398.98607455,
        398.105,
    ],
    [
        1169.66,
        1170.13297743,
        1166.59550421,
        1162.50625,
        1162.50625,
        1165.93449579,
        1169.18702257,
        1169.66,
    ],
    [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
]

pose_translation = [411.4199861830012, 1181.197175631848, 0.0]
pose_rotation = [
    0.5720063498929273,
    -0.0021434844534272707,
    0.011564094980151613,
    -0.8201648693182716,
]
pose_quaternion_rotation_mat = [
    [-0.34560828, 0.93822945, 0.01674549],
    [-0.9383286, -0.34535001, -0.01651676],
    [-0.00971345, -0.0214211, 0.99972335],
]
# Subtract pose translation
points3 = [
    [
        -13.31498618,
        -14.19606073,
        -16.0812907,
        -16.45373618,
        -16.45373618,
        -14.19368167,
        -12.43391164,
        -13.31498618,
    ],
    [
        -11.53717563,
        -11.06419821,
        -14.60167142,
        -18.69092563,
        -18.69092563,
        -15.26267984,
        -12.01015306,
        -11.53717563,
    ],
    [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
]
# Perform pose rotation
points4 = [
    [
        1.54274314e01,
        1.52881298e01,
        1.92589932e01,
        2.32247776e01,
        2.32247776e01,
        1.92268630e01,
        1.55667330e01,
        1.54274314e01,
    ],
    [
        -8.50814841e00,
        -9.49814126e00,
        -1.00452531e01,
        -8.98246843e00,
        -8.98246843e00,
        -8.04596345e00,
        -7.51815556e00,
        -8.50814841e00,
    ],
    [
        -3.24092968e-02,
        -5.49753768e-02,
        -2.81169016e-02,
        3.31875270e-02,
        3.31875270e-02,
        1.44097563e-02,
        -9.84321687e-03,
        -3.24092968e-02,
    ],
]

cam_translation = [1.70079118954, 0.0159456324149, 1.51095763913]
cam_rotation = [
    0.4998015430569128,
    -0.5030316162024876,
    0.4997798114386805,
    -0.49737083824542755,
]
cam_quaternion_rotation_mat = [
    [5.68477868e-03, -5.63666773e-03, 9.99967955e-01],
    [-9.99983517e-01, -8.37115272e-04, 5.68014846e-03],
    [8.05071338e-04, -9.99983763e-01, -5.64133364e-03],
]
# Cam translation
points5 = [
    [
        13.72664019,
        13.5873386,
        17.55820199,
        21.52398642,
        21.52398642,
        17.52607178,
        13.86594177,
        13.72664019,
    ],
    [
        -8.52409404,
        -9.51408689,
        -10.06119874,
        -8.99841406,
        -8.99841406,
        -8.06190909,
        -7.53410119,
        -8.52409404,
    ],
    [
        -1.54336694,
        -1.56593302,
        -1.53907454,
        -1.47777011,
        -1.47777011,
        -1.49654788,
        -1.52080086,
        -1.54336694,
    ],
]


# Rotated camera
points6 = [
    [
        8.60074393,
        9.5899104,
        10.15960834,
        9.11943514,
        9.11943514,
        8.16020322,
        7.61157747,
        8.60074393,
    ],
    [
        1.47310502,
        1.49728466,
        1.44850218,
        1.36395527,
        1.36395527,
        1.40448369,
        1.44892537,
        1.47310502,
    ],
    [
        13.68648885,
        13.54169572,
        17.50917267,
        21.48052095,
        21.48052095,
        17.48815984,
        13.83128197,
        13.68648885,
    ],
]

# View points
points7 = [
    [
        1.61209787e03,
        1.71311390e03,
        1.55109916e03,
        1.35391737e03,
        1.35391737e03,
        1.40719379e03,
        1.51319682e03,
        1.61209787e03,
    ],
    [
        6.27814161e02,
        6.31532887e02,
        5.96275470e02,
        5.71921150e02,
        5.71921150e02,
        5.93213724e02,
        6.24173294e02,
        6.27814161e02,
    ],
    [
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
        1.00000000e00,
    ],
]

# Cam intrinsics
cam_intrinsics = [
    [1.26641720e03, 0.00000000e00, 8.16267020e02],
    [0.00000000e00, 1.26641720e03, 4.91507066e02],
    [0.00000000e00, 0.00000000e00, 1.00000000e00],
]

import numpy as np

points = np.array(points6)
view = np.array(cam_intrinsics)
# print(view)
viewpad = np.eye(4)
viewpad[: view.shape[0], : view.shape[1]] = view
# print(viewpad)

nbr_points = points.shape[1]

# Do operation in homogenous coordinates.
points = np.concatenate((points, np.ones((1, nbr_points))))
points = np.dot(viewpad, points)
points = points[:3, :]
# points = points / points[2:3, :].repeat(3, 0).reshape(3, nbr_points)

norm = points[2:3, :].repeat(3, 0).reshape(3, nbr_points)
print(points)
print(points[2:3, :])
print(norm)
